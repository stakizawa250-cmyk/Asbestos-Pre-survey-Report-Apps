<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>アスベスト事前報告書DX</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (JSX変換用) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- html2pdf.js (PDF生成用) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <!-- Google Fonts (Noto Sans JP) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        /* アニメーション定義 */
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slide-in-from-top-4 { from { transform: translateY(-1rem); } to { transform: translateY(0); } }
        @keyframes zoom-in { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .animate-in { animation-fill-mode: both; }
        .fade-in { animation-name: fade-in; animation-duration: 0.5s; }
        .slide-in-from-top-4 { animation-name: slide-in-from-top-4; }
        .zoom-in-95 { animation-name: zoom-in; }
        
        /* カスタムスクロールバー */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* 印刷用スタイル */
        @media print {
            @page {
                size: A4;
                margin: 15mm;
            }
            body { background: white !important; padding: 0 !important; -webkit-print-color-adjust: exact; }
            .min-h-screen { min-height: auto; }
            header, footer, .lg\:col-span-7, .bg-gradient-to-br, .print\:hidden, button { display: none !important; }
            .lg\:col-span-5 { width: 100% !important; margin: 0 !important; position: static !important; }
            .bg-slate-900 { border: none !important; box-shadow: none !important; padding: 0 !important; background: white !important; }
            .font-mono { 
                border: none !important; 
                font-size: 11pt !important; 
                line-height: 1.8 !important; 
                color: black !important;
                padding: 0 !important;
                min-height: auto !important;
                font-family: 'Noto Sans JP', monospace !important;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Lucide Icons Components (SVG定義) ---
        // ライブラリ依存を避けるため、必要なアイコンをコンポーネント化しています
        const IconBase = ({ children, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                {children}
            </svg>
        );

        const Building2 = (props) => <IconBase {...props}><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></IconBase>;
        const FileText = (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></IconBase>;
        const Clipboard = (props) => <IconBase {...props}><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/></IconBase>;
        const ClipboardCheck = (props) => <IconBase {...props}><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="m9 14 2 2 4-4"/></IconBase>;
        const Download = (props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></IconBase>;
        const CheckCircle2 = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></IconBase>;
        const Check = (props) => <IconBase {...props}><polyline points="20 6 9 17 4 12"/></IconBase>;
        const AlertCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></IconBase>;
        const HardHat = (props) => <IconBase {...props}><path d="M2 18a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v2z"/><path d="M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5"/><path d="M4 15v-3a6 6 0 0 1 6-6h0"/><path d="M14 6h0a6 6 0 0 1 6 6v3"/></IconBase>;
        const Printer = (props) => <IconBase {...props}><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></IconBase>;
        const Info = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></IconBase>;
        const FileType = (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M9 13v-1h6v1"/><path d="M12 12v6"/><path d="M11 18h2"/></IconBase>;
        const ChevronRight = (props) => <IconBase {...props}><path d="m9 18 6-6-6-6"/></IconBase>;

        // --- Main App Component ---
        const App = () => {
            // 基本情報ステート（初期値は空）
            const [basicInfo, setBasicInfo] = useState({
                dept: '',
                inspector: '',
                surveyType: 'A：調査あり（2006年以前の建物で改造・修繕がある場合）',
                surveyMethod: '書面調査',
                buildingAge: '',
                structure: '選択してください',
                fireproof: '選択してください',
                floorArea: '',
                floors: '',
                contractor: ''
            });

            const [isCopied, setIsCopied] = useState(false);
            const [isGenerating, setIsGenerating] = useState(false);
            const reportRef = useRef(null);

            // 事前調査の選択肢
            const surveyOptions = [
                "A：調査あり（2006年以前の建物で改造・修繕がある場合）",
                "B：調査なし（解体・改造・補修が発生しない・軽微な破損）",
                "C：調査なし（2006年以降の建物）",
                "D：調査なし（石・木・ガラス・金属・陶器・畳・照明のみ除去）",
                "E：調査なし（塗装のみ作業）",
                "F：調査なし（追加工事：B～Eに該当）"
            ];

            // 判断項目ステート
            const materialsList = [
                "仕上塗材", "ストレート波板", "屋根用化粧ストレート", "ケイ酸カルシウム板第一種",
                "押出成形セメント板", "パルプセメント", "ビニル床タイル", "窯業系サイディング",
                "石膏ボード", "ロックウール吸音天井板", "その他の材料", "上記以外や判断が難しい場合"
            ];

            // 初期値を「該当なし」に設定
            const [judgments, setJudgments] = useState(
                materialsList.reduce((acc, curr) => ({ ...acc, [curr]: '該当なし' }), {})
            );

            const [remarks, setRemarks] = useState('');
            const [reportText, setReportText] = useState('');

            // 調査が必要なタイプかどうか
            const isSurveyRequired = basicInfo.surveyType.startsWith('A');

            // レポート生成ロジック
            useEffect(() => {
                let text = `【 アスベスト事前報告書 】\n`;
                text += `作成日時: ${new Date().toLocaleDateString('ja-JP')} ${new Date().toLocaleTimeString('ja-JP')}\n`;
                text += `------------------------------------------------------------\n\n`;
                text += `■ 基本情報\n`;
                text += `営業部署：${basicInfo.dept || '（未入力）'}\n`;
                text += `調査者名：${basicInfo.inspector || '（未入力）'}\n`;
                text += `事前調査：${basicInfo.surveyType}\n`;

                if (isSurveyRequired) {
                    text += `事前調査方法：${basicInfo.surveyMethod || '（未入力）'}\n`;
                    text += `建築年数：${basicInfo.buildingAge || '（未入力）'}年\n`;
                    text += `建物の構造：${basicInfo.structure === '選択してください' ? '（未選択）' : basicInfo.structure}\n`;
                    text += `建物耐火：${basicInfo.fireproof === '選択してください' ? '（未選択）' : basicInfo.fireproof}\n`;
                    text += `延床面積 (㎡)：${basicInfo.floorArea || '（未入力）'}\n`;
                    text += `建物全体の階：${basicInfo.floors || '（未入力）'}\n`;
                    text += `解体運搬回収予定業者：${basicInfo.contractor || '（未入力）'}\n\n`;

                    text += `■ 判断項目（材料別判定）\n`;
                    materialsList.forEach(name => {
                        text += `・${name}：${judgments[name] || '該当なし'}\n`;
                    });
                } else {
                    text += `\n※本案件は事前調査および材料判定の対象外です。\n\n`;
                }
                
                text += `\n■ 備考\n${remarks || '特記事項なし'}`;

                setReportText(text);
            }, [basicInfo, judgments, remarks, isSurveyRequired]);

            const handleCopy = () => {
                try {
                    const textArea = document.createElement("textarea");
                    textArea.value = reportText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand("copy");
                    document.body.removeChild(textArea);
                    setIsCopied(true);
                    setTimeout(() => setIsCopied(false), 2000);
                } catch (err) {
                    console.error("Copy failed", err);
                }
            };

            const handleDownloadPDF = async () => {
                if (!window.html2pdf) {
                    alert("ライブラリを読み込み中です。数秒後にもう一度お試しください。");
                    return;
                }

                setIsGenerating(true);
                const element = reportRef.current;
                const dateStr = new Date().toISOString().split('T')[0];
                const filename = `アスベスト報告書_${dateStr}.pdf`;

                const opt = {
                    margin:       [15, 15, 20, 15], 
                    filename:     filename,
                    image:        { type: 'jpeg', quality: 1.0 },
                    html2canvas:  { 
                        scale: 2, 
                        useCORS: true,
                        letterRendering: true,
                        scrollY: 0
                    },
                    jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
                    pagebreak:    { mode: ['avoid-all', 'css', 'legacy'] }
                };

                try {
                    await window.html2pdf().set(opt).from(element).save();
                } catch (error) {
                    console.error("PDF generation failed", error);
                    alert("PDFの生成に失敗しました。印刷機能をお試しください。");
                } finally {
                    setIsGenerating(false);
                }
            };

            return (
                <div className="min-h-screen bg-[#f1f5f9] text-slate-900 font-sans selection:bg-blue-200 pb-20">
                    <div className="fixed inset-0 pointer-events-none overflow-hidden opacity-30 print:hidden">
                        <div className="absolute top-[-10%] right-[-10%] w-[50%] h-[50%] bg-blue-300 blur-[150px] rounded-full"></div>
                        <div className="absolute bottom-[-10%] left-[-10%] w-[40%] h-[40%] bg-indigo-200 blur-[120px] rounded-full"></div>
                    </div>

                    <div className="relative max-w-6xl mx-auto px-4 sm:px-6 pt-12">
                        
                        <header className="mb-10 text-center print:hidden">
                            <div className="inline-flex items-center gap-2 px-4 py-1.5 bg-white shadow-sm border border-slate-200 rounded-full mb-6">
                                <span className="flex h-2 w-2 rounded-full bg-blue-500 animate-pulse"></span>
                                <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Asbestos Reporting DX</span>
                            </div>
                            <h1 className="text-3xl md:text-5xl font-black text-slate-900 tracking-tight mb-4">
                                アスベスト<span className="text-blue-600">事前報告書</span>
                            </h1>
                            <p className="text-slate-500 max-w-lg mx-auto text-sm leading-relaxed">
                                現場でのヒアリングから報告書生成、PDF保存までを完結させるデジタルワークフロー。
                            </p>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
                            
                            {/* 左：フォーム入力エリア */}
                            <div className="lg:col-span-7 space-y-6 print:hidden">
                                
                                <section className="bg-white rounded-[1.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 overflow-hidden">
                                    <div className="px-6 py-5 border-b border-slate-100 flex items-center gap-3 bg-slate-50/50">
                                        <div className="p-2 bg-slate-900 rounded-xl shadow-lg">
                                            <Building2 className="w-5 h-5 text-white" />
                                        </div>
                                        <h2 className="text-lg font-black text-slate-800">基本情報</h2>
                                    </div>
                                    
                                    <div className="p-6 space-y-5">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div className="space-y-1">
                                                <label className="text-[10px] font-black text-slate-400 uppercase tracking-wider ml-1">営業部署</label>
                                                <input 
                                                    type="text" 
                                                    placeholder="例: 東京第一営業部"
                                                    className="w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 outline-none transition-all"
                                                    value={basicInfo.dept}
                                                    onChange={(e) => setBasicInfo({...basicInfo, dept: e.target.value})}
                                                />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[10px] font-black text-slate-400 uppercase tracking-wider ml-1">調査者名</label>
                                                <input 
                                                    type="text" 
                                                    placeholder="例: 山田 太郎"
                                                    className="w-full px-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 outline-none transition-all"
                                                    value={basicInfo.inspector}
                                                    onChange={(e) => setBasicInfo({...basicInfo, inspector: e.target.value})}
                                                />
                                            </div>
                                        </div>

                                        <div className="space-y-1">
                                            <label className="text-[10px] font-black text-slate-400 uppercase tracking-wider ml-1">事前調査種別</label>
                                            <div className="relative">
                                                <select 
                                                    className="w-full appearance-none px-4 py-3 bg-slate-900 text-white rounded-xl focus:ring-4 focus:ring-blue-500/20 outline-none cursor-pointer font-bold text-sm"
                                                    value={basicInfo.surveyType}
                                                    onChange={(e) => setBasicInfo({...basicInfo, surveyType: e.target.value})}
                                                >
                                                    {surveyOptions.map(opt => <option key={opt} value={opt} className="bg-white text-slate-800">{opt}</option>)}
                                                </select>
                                                <div className="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50">
                                                    <ChevronRight className="w-4 h-4 rotate-90" />
                                                </div>
                                            </div>
                                        </div>

                                        {isSurveyRequired ? (
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2 p-5 bg-blue-50/50 border border-blue-100 rounded-2xl animate-in fade-in">
                                                <div className="space-y-1">
                                                    <label className="text-[10px] font-bold text-blue-500 ml-1">調査方法</label>
                                                    <select className="w-full px-3 py-2 bg-white border border-blue-100 rounded-lg outline-none"
                                                        value={basicInfo.surveyMethod}
                                                        onChange={(e) => setBasicInfo({...basicInfo, surveyMethod: e.target.value})}>
                                                        <option>書面調査</option><option>目視調査</option><option>分析調査</option>
                                                    </select>
                                                </div>
                                                <div className="space-y-1">
                                                    <label className="text-[10px] font-bold text-blue-500 ml-1">建築年数</label>
                                                    <input type="number" placeholder="20" className="w-full px-3 py-2 bg-white border border-blue-100 rounded-lg outline-none"
                                                        value={basicInfo.buildingAge} onChange={(e) => setBasicInfo({...basicInfo, buildingAge: e.target.value})} />
                                                </div>
                                                <div className="space-y-1">
                                                    <label className="text-[10px] font-bold text-blue-500 ml-1">建物の構造</label>
                                                    <select className="w-full px-3 py-2 bg-white border border-blue-100 rounded-lg outline-none"
                                                        value={basicInfo.structure} onChange={(e) => setBasicInfo({...basicInfo, structure: e.target.value})}>
                                                        <option>選択してください</option><option>木造</option><option>鉄骨造</option><option>鉄筋コンクリート造</option>
                                                    </select>
                                                </div>
                                                <div className="space-y-1">
                                                    <label className="text-[10px] font-bold text-blue-500 ml-1">建物耐火</label>
                                                    <select className="w-full px-3 py-2 bg-white border border-blue-100 rounded-lg outline-none"
                                                        value={basicInfo.fireproof} onChange={(e) => setBasicInfo({...basicInfo, fireproof: e.target.value})}>
                                                        <option>選択してください</option><option>耐火構造</option><option>準耐火構造</option><option>その他</option>
                                                    </select>
                                                </div>
                                                <div className="space-y-1">
                                                    <label className="text-[10px] font-bold text-blue-500 ml-1">延床面積 (㎡)</label>
                                                    <input type="text" placeholder="1250" className="w-full px-3 py-2 bg-white border border-blue-100 rounded-lg outline-none"
                                                        value={basicInfo.floorArea} onChange={(e) => setBasicInfo({...basicInfo, floorArea: e.target.value})} />
                                                </div>
                                                <div className="space-y-1">
                                                    <label className="text-[10px] font-bold text-blue-500 ml-1">階数</label>
                                                    <input type="text" placeholder="地上5階" className="w-full px-3 py-2 bg-white border border-blue-100 rounded-lg outline-none"
                                                        value={basicInfo.floors} onChange={(e) => setBasicInfo({...basicInfo, floors: e.target.value})} />
                                                </div>
                                                <div className="md:col-span-2 space-y-1">
                                                    <label className="text-[10px] font-bold text-blue-500 ml-1">解体運搬回収予定業者</label>
                                                    <div className="relative">
                                                        <input type="text" placeholder="株式会社〇〇環境" className="w-full pl-9 pr-4 py-2 bg-white border border-blue-100 rounded-lg outline-none"
                                                            value={basicInfo.contractor} onChange={(e) => setBasicInfo({...basicInfo, contractor: e.target.value})} />
                                                        <div className="absolute left-3 top-1/2 -translate-y-1/2 text-blue-300">
                                                            <HardHat className="w-4 h-4" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="p-5 bg-amber-50 border border-amber-100 rounded-2xl flex items-start gap-4 animate-in fade-in">
                                                <div className="text-amber-500 shrink-0">
                                                    <AlertCircle className="w-5 h-5" />
                                                </div>
                                                <p className="text-amber-800 text-xs leading-relaxed">
                                                    「調査なし」を選択しているため、詳細情報および材料判定は省略されます。
                                                </p>
                                            </div>
                                        )}
                                    </div>
                                </section>

                                {isSurveyRequired && (
                                    <section className="bg-white rounded-[1.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 overflow-hidden animate-in fade-in zoom-in-95">
                                        <div className="px-6 py-5 border-b border-slate-100 bg-emerald-50/30 flex items-center gap-3">
                                            <div className="p-2 bg-emerald-600 rounded-xl shadow-lg shadow-emerald-200">
                                                <CheckCircle2 className="w-5 h-5 text-white" />
                                            </div>
                                            <h2 className="text-lg font-black text-slate-800">材料別判定</h2>
                                        </div>
                                        <div className="p-6 grid grid-cols-1 gap-2">
                                            {materialsList.map((material) => (
                                                <div key={material} className="flex items-center justify-between p-3 bg-slate-50 border border-slate-100 rounded-xl hover:bg-white transition-all">
                                                    <span className="text-[11px] font-bold text-slate-600">{material}</span>
                                                    <select 
                                                        className={`px-3 py-1.5 rounded-lg text-[11px] font-black outline-none border ${
                                                            judgments[material] === '該当なし' 
                                                            ? 'bg-white border-slate-200 text-slate-400' 
                                                            : 'bg-blue-600 border-blue-600 text-white'
                                                        }`}
                                                        value={judgments[material]}
                                                        onChange={(e) => setJudgments({...judgments, [material]: e.target.value})}
                                                    >
                                                        <option className="text-slate-800">該当なし</option>
                                                        <option className="text-slate-800">みなし</option>
                                                        <option className="text-slate-800">石綿含有</option>
                                                        <option className="text-slate-800">石綿含まない</option>
                                                    </select>
                                                </div>
                                            ))}
                                        </div>
                                    </section>
                                )}

                                <section className="bg-white rounded-[1.5rem] border border-slate-200 shadow-xl shadow-slate-200/50 overflow-hidden">
                                    <div className="px-6 py-4 flex items-center gap-3 bg-slate-50/50">
                                        <div className="text-slate-400">
                                            <FileText className="w-4 h-4" />
                                        </div>
                                        <h2 className="text-sm font-black text-slate-700 uppercase tracking-widest">備考</h2>
                                    </div>
                                    <div className="p-6 pt-0">
                                        <textarea 
                                            className="w-full px-5 py-4 bg-slate-50 border border-slate-200 rounded-2xl focus:bg-white focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 outline-none h-28 transition-all text-sm"
                                            placeholder="現場状況などの補足情報"
                                            value={remarks}
                                            onChange={(e) => setRemarks(e.target.value)}
                                        ></textarea>
                                    </div>
                                </section>
                            </div>

                            {/* 右：プレビューと出力 */}
                            <div className="lg:col-span-5 lg:sticky lg:top-8 space-y-6">
                                <div className="bg-slate-900 border-4 border-slate-900 rounded-[2rem] shadow-2xl overflow-hidden flex flex-col h-[75vh] print:h-auto">
                                    
                                    <div className="flex-1 bg-white flex flex-col overflow-hidden print:overflow-visible">
                                        <div className="px-4 py-3 bg-slate-50 border-b border-slate-200 flex justify-between items-center print:hidden">
                                            <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">A4 Report Preview</span>
                                            <div className="px-2 py-0.5 bg-blue-100 text-blue-600 text-[8px] font-black rounded-full uppercase">Print Ready</div>
                                        </div>

                                        {/* スクロールエリア */}
                                        <div className="flex-1 overflow-auto bg-slate-200 p-4 sm:p-6 custom-scrollbar print:bg-white print:p-0 print:overflow-visible">
                                            {/* PDF化される本体領域 */}
                                            <div 
                                                ref={reportRef}
                                                className="bg-white mx-auto shadow-sm font-mono text-[14px] text-slate-800 leading-[1.8] whitespace-pre-wrap p-10 sm:p-14 min-h-full"
                                                style={{ width: '100%', boxSizing: 'border-box' }}
                                            >
                                                {reportText}
                                            </div>
                                        </div>

                                        <div className="p-5 bg-white border-t border-slate-200 space-y-3 print:hidden">
                                            <button 
                                                onClick={handleDownloadPDF}
                                                disabled={isGenerating}
                                                className={`w-full flex items-center justify-center gap-2 px-6 py-4 rounded-xl font-black transition-all active:scale-[0.98] shadow-lg ${
                                                    isGenerating 
                                                    ? 'bg-slate-100 text-slate-400 cursor-not-allowed' 
                                                    : 'bg-blue-600 hover:bg-blue-700 text-white shadow-blue-200'
                                                }`}
                                            >
                                                {isGenerating ? "生成中..." : <><Download className="w-5 h-5" /> PDF保存 (A4サイズ・複数頁対応)</>}
                                            </button>

                                            <div className="grid grid-cols-2 gap-3">
                                                <button 
                                                    onClick={handleCopy}
                                                    className="flex items-center justify-center gap-2 px-4 py-3 bg-slate-800 hover:bg-slate-700 text-white font-bold rounded-xl transition-all active:scale-[0.98]"
                                                >
                                                    {isCopied ? <span className="text-emerald-400 flex items-center gap-1"><Check className="w-4 h-4" /> 完了</span> : <><Clipboard className="w-4 h-4" /> コピー</>}
                                                </button>
                                                <button 
                                                    onClick={() => window.print()}
                                                    className="flex items-center justify-center gap-2 px-4 py-3 bg-white border-2 border-slate-200 hover:bg-slate-50 text-slate-600 font-bold rounded-xl transition-all active:scale-[0.98]"
                                                >
                                                    <Printer className="w-4 h-4" /> 印刷
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="p-5 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-[2rem] text-white shadow-xl shadow-blue-500/20 relative overflow-hidden group print:hidden">
                                    <div className="absolute top-0 right-0 w-24 h-24 bg-white/10 blur-2xl rounded-full -mr-10 -mt-10 group-hover:bg-white/20 transition-all"></div>
                                    <div className="flex items-start gap-4 relative z-10">
                                        <div className="text-blue-200 shrink-0">
                                            <Info className="w-5 h-5" />
                                        </div>
                                        <div>
                                            <h3 className="font-black mb-1 text-xs uppercase tracking-wider">PDF出力の改善</h3>
                                            <p className="text-blue-100 text-[10px] leading-relaxed">
                                                内容が長い場合でも、自動的に改ページして2枚目以降を出力するように修正しました。下部が切れる心配はありません。
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <footer className="mt-12 text-center text-slate-400 text-[10px] font-bold tracking-widest uppercase pb-10 print:hidden">
                            &copy; 2026 Asbestos DX System
                        </footer>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>